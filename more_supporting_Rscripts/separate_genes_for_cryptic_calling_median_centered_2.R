

# for 120min
# cd /proj/strahllb/users/Jie/Stephen/PanelF_median_normalized/ 
# bsub -M 20 -q week Rscript /proj/strahllb/users/Jie/Stephen/separate_genes_for_cryptic_calling_median_centered_2.R  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep1_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep2_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep3_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep1_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep2_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep3_senseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep1_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep2_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep3_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep1_antisenseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep2_antisenseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep3_antisenseStrand_full_genes_filledNAs_named.coord 1 1000
# bsub -M 20 -q week Rscript /proj/strahllb/users/Jie/Stephen/separate_genes_for_cryptic_calling_median_centered_2.R  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep1_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep2_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep3_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep1_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep2_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep3_senseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep1_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep2_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep3_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep1_antisenseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep2_antisenseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep3_antisenseStrand_full_genes_filledNAs_named.coord 1001 2000
# bsub -M 20 -q week Rscript /proj/strahllb/users/Jie/Stephen/separate_genes_for_cryptic_calling_median_centered_2.R  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep1_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep2_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep3_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep1_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep2_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep3_senseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep1_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep2_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep3_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep1_antisenseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep2_antisenseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep3_antisenseStrand_full_genes_filledNAs_named.coord 2001 3000
# bsub -M 20 -q week Rscript /proj/strahllb/users/Jie/Stephen/separate_genes_for_cryptic_calling_median_centered_2.R  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep1_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep2_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep3_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep1_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep2_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep3_senseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep1_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep2_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep3_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep1_antisenseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep2_antisenseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep3_antisenseStrand_full_genes_filledNAs_named.coord 3001 4000
# bsub -M 20 -q week Rscript /proj/strahllb/users/Jie/Stephen/separate_genes_for_cryptic_calling_median_centered_2.R  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep1_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep2_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep3_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep1_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep2_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep3_senseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep1_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep2_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep3_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep1_antisenseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep2_antisenseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep3_antisenseStrand_full_genes_filledNAs_named.coord 4001 5000
# bsub -M 20 -q week Rscript /proj/strahllb/users/Jie/Stephen/separate_genes_for_cryptic_calling_median_centered_2.R  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep1_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep2_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep3_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep1_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep2_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep3_senseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep1_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep2_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep3_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep1_antisenseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep2_antisenseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep3_antisenseStrand_full_genes_filledNAs_named.coord 5001 6000
# bsub -M 20 -q week Rscript /proj/strahllb/users/Jie/Stephen/separate_genes_for_cryptic_calling_median_centered_2.R  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep1_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep2_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep3_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep1_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep2_senseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_senseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep3_senseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep1_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep2_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_WT_120min_Rep3_antisenseStrand_full_genes_filledNAs_named.coord  /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep1_antisenseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep2_antisenseStrand_full_genes_filledNAs_named.coord /proj/strahllb/users/Jie/Stephen/yeast_120min_antisenseStrand_full_genes_filledNAs_named.coord/yeast_SET2del_120min_Rep3_antisenseStrand_full_genes_filledNAs_named.coord 6001 6692



args = commandArgs(trailingOnly = TRUE)

#read in matrices

WT_rep1.mat = read.table(args[1], sep="\t", row.names=1, header=T)
WT_rep2.mat = read.table(args[2], sep="\t", row.names=1, header=T)
WT_rep3.mat = read.table(args[3], sep="\t", row.names=1, header=T)
mut_rep1.mat = read.table(args[4], sep="\t", row.names=1, header=T)
mut_rep2.mat = read.table(args[5], sep="\t", row.names=1, header=T)
mut_rep3.mat = read.table(args[6], sep="\t", row.names=1, header=T)
dim(WT_rep1.mat)
dim(WT_rep2.mat )
dim(WT_rep3.mat )
dim(mut_rep1.mat)
dim(mut_rep2.mat)
dim(mut_rep3.mat)

as.WT_rep1.mat = read.table(args[7], sep="\t", row.names=1, header=T)
as.WT_rep2.mat = read.table(args[8], sep="\t", row.names=1, header=T)
as.WT_rep3.mat = read.table(args[9], sep="\t", row.names=1, header=T)
as.mut_rep1.mat = read.table(args[10], sep="\t", row.names=1, header=T)
as.mut_rep2.mat = read.table(args[11], sep="\t", row.names=1, header=T)
as.mut_rep3.mat = read.table(args[12], sep="\t", row.names=1, header=T)
dim(as.WT_rep1.mat)
dim(as.WT_rep2.mat )
dim(as.WT_rep3.mat )
dim(as.mut_rep1.mat)
dim(as.mut_rep2.mat)
dim(as.mut_rep3.mat)


info = read.table('/proj/strahllb/users/Jie/Stephen/submission/all_output_rm_badmatch.txt', header=T, sep='\t')
cryp_name = as.character(info$Gene_Name)[info$Group=='High'|info$Group=='Medium']
cryp_th = as.numeric(info$Best_Theta)[info$Group=='High'|info$Group=='Medium']
cryp_expression_WT = c()
cryp_expression_mut = c()
as.cryp_expression_WT = c()
as.cryp_expression_mut = c()

bg_expression_WT = c()
bg_expression_mut = c()
as.bg_expression_WT = c()
as.bg_expression_mut = c()


background_name = c()
cryp_gene_name = c()

j=1
k=1

#for (i in c(4147, 5780)) {
for(i in as.numeric(args[13]):as.numeric(args[14])){
  print(i)
  #get average of reps
 
  WT.avg = apply(rbind(WT_rep1.mat[i,(6:ncol(WT_rep1.mat))],WT_rep2.mat[i,(6:ncol(WT_rep2.mat))],WT_rep3.mat[i,(6:ncol(WT_rep3.mat))]),2, mean)
  WT.avg = WT.avg[!is.na(WT.avg)]
  WT.median = median(WT.avg)
  mut.avg = apply(rbind(mut_rep1.mat[i,(6:ncol(mut_rep1.mat))],mut_rep2.mat[i,(6:ncol(mut_rep2.mat))],mut_rep3.mat[i,(6:ncol(mut_rep3.mat))]),2, mean)
  mut.avg = mut.avg[!is.na(mut.avg)]
  mut.median = median(mut.avg)
  
  as.WT.avg = apply(rbind(as.WT_rep1.mat[i,(6:ncol(as.WT_rep1.mat))],as.WT_rep2.mat[i,(6:ncol(as.WT_rep2.mat))],as.WT_rep3.mat[i,(6:ncol(as.WT_rep3.mat))]),2, mean)
  as.WT.avg = as.WT.avg[!is.na(as.WT.avg)]
  as.mut.avg = apply(rbind(as.mut_rep1.mat[i,(6:ncol(as.mut_rep1.mat))],as.mut_rep2.mat[i,(6:ncol(as.mut_rep2.mat))],as.mut_rep3.mat[i,(6:ncol(as.mut_rep3.mat))]),2, mean)
  as.mut.avg = as.mut.avg[!is.na(as.mut.avg)]
  
  mut.avg = mut.avg * WT.median / mut.median
  as.mut.avg = as.mut.avg * WT.median / mut.median

  if (row.names(WT_rep1.mat)[i] %in% cryp_name) {
    
    idx = which(cryp_name == row.names(WT_rep1.mat)[i])
    th = cryp_th[idx]
    WT.pre = mean(WT.avg[1:th])
    mut.pre = mean(mut.avg[1:th])
    cryp_expression_WT = c(cryp_expression_WT, WT.pre)
    cryp_expression_mut = c(cryp_expression_mut, mut.pre)
    as.WT.pre = mean(as.WT.avg[1:th])
    as.mut.pre = mean(as.mut.avg[1:th])
    as.cryp_expression_WT = c(as.cryp_expression_WT, as.WT.pre)
    as.cryp_expression_mut = c(as.cryp_expression_mut, as.mut.pre)
    cryp_gene_name = c(cryp_gene_name, row.names(WT_rep1.mat)[i])
    #write.table(rbind(c("ss.WT",row.names(WT_rep1.mat[i,]),  WT.avg), c("ss.mut", row.names(WT_rep1.mat[i,]),  mut.avg), c("as.WT", row.names(WT_rep1.mat[i,]),  as.mut.avg), c("as.mut", row.names(WT_rep1.mat[i,]),  as.mut.avg)), file=paste0("cryp_gene_", j, ".txt"), sep="\t", quote=F, row.names=F, col.names=F)
    j=j+1
  } else if(mean(WT.avg) <= 5 | mean(mut.avg) <= 5 | is.na(mean(WT.avg))| is.na(mean(mut.avg))){
    cat(paste0("Gene #", i, " aka ", row.names(WT_rep1.mat)[i], " had too few reads! It has an average of ", mean(WT.avg), " WT reads and ", mean(mut.avg), " mutant reads; it must be at least 5\n"))
  } else if(length(WT.avg) <= 700| is.na(length(WT.avg))){
    cat(paste0("Gene #", i, " aka ", row.names(WT_rep1.mat)[i], " was too small! It was ", length(WT.avg), " and it must be at least 700bp\n"))
  } else { 
    set.seed(i)
    th = sample(151 : (length(WT.avg)-150), 1)
    WT.pre = mean(WT.avg[1:th])
    mut.pre = mean(mut.avg[1:th])
    bg_expression_WT = c(bg_expression_WT, WT.pre)
    bg_expression_mut = c(bg_expression_mut, mut.pre)
    as.WT.pre = mean(as.WT.avg[1:th])
    as.mut.pre = mean(as.mut.avg[1:th])
    as.bg_expression_WT = c(as.bg_expression_WT, as.WT.pre)
    as.bg_expression_mut = c(as.bg_expression_mut, as.mut.pre)
    #write.table(rbind(c("ss.WT",row.names(WT_rep1.mat[i,]),  WT.avg), c("ss.mut", row.names(WT_rep1.mat[i,]),  mut.avg), c("as.WT", row.names(WT_rep1.mat[i,]),  as.mut.avg), c("as.mut", row.names(WT_rep1.mat[i,]),  as.mut.avg)), file=paste0("background_gene_", k, ".txt"), sep="\t", quote=F, row.names=F, col.names=F)
    k=k+1
    background_name = c(background_name, row.names(WT_rep1.mat[i,]))
  }
  
}

out.cryp = data.frame(cryp_gene_name, cryp_expression_WT,cryp_expression_mut,as.cryp_expression_WT, as.cryp_expression_mut)
out.bg = data.frame(background_name, bg_expression_WT,bg_expression_mut,as.bg_expression_WT, as.bg_expression_mut)

write.table(out.cryp, file=paste0('cryp_gene_pre_th_expression_median_normalized_', args[13],'.txt'), sep="\t", quote=F, row.names=F, col.names=F)
write.table(out.bg , file=paste0('background_gene_pre_th_expression_median_normalized_', args[13],'.txt'), sep="\t", quote=F, row.names=F, col.names=F)

# cat /nas02/home/j/h/jh259/cryp_gene_pre_th_expression_median_normalized* > /nas02/home/j/h/jh259/cryp_gene_pre_th_expression_median_normalized_combined.txt
# cat /nas02/home/j/h/jh259/background_gene_pre_th_expression_median_normalized* > /nas02/home/j/h/jh259/background_gene_pre_th_expression_median_normalized_combined.txt
